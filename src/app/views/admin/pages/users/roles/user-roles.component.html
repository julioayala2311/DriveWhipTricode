<div class="page-header d-flex align-items-center justify-content-between mb-3">
  <div>
    <h5 class="page-title mb-1">User Roles</h5>
    <!-- <small class="text-muted">Manage role definitions</small> -->
  </div>
  <div class="d-flex gap-2">
    <button
      class="btn btn-sm btn-ghost"
      (click)="loadRoles()"
      [disabled]="loading()"
    >
      Refresh
    </button>
    <button
      class="btn btn-sm btn-primary"
      (click)="onCreate()"
      [disabled]="loading()"
    >
      Create Role
    </button>
  </div>
</div>

<dw-role-dialog
  *ngIf="showDialog()"
  [mode]="dialogMode()"
  [record]="editingRecord()"
  [existingRoleNames]="roleNames()"
  [saving]="saving()"
  (closed)="closeDialog()"
  (saved)="handleDialogSave($event)"
></dw-role-dialog>

<div *ngIf="error()" class="alert alert-danger py-2 px-3 mb-3">
  {{ error() }}
</div>

<div *ngIf="loading()" class="p-3">Loading roles...</div>

<!-- GRID PADRE (ROLES) -->
<ag-grid-angular
  *ngIf="!loading()"
  class="ag-theme-quartz dw-grid-theme"
  style="width: 100%; height: 440px"
  [rowData]="roles()"
  [columnDefs]="columnDefs"
  [defaultColDef]="defaultColDef"
  rowSelection="single"
  [suppressRowClickSelection]="false"
  [enableCellTextSelection]="true"
  [pagination]="true"
  [paginationPageSize]="pageSize"
  [paginationPageSizeSelector]="pageSizeOptions"
  (gridReady)="onGridReady($event)"
  (cellClicked)="onCellClicked($event)"
  (cellKeyDown)="onGridCellKeyDown($event)"
  (selectionChanged)="onRoleSelectionChanged()"
>
</ag-grid-angular>

<!-- GRID HIJO (PERMISOS DEL ROL SELECCIONADO) -->
<div class="mt-3" *ngIf="selectedRole()">
  <div class="d-flex align-items-center justify-content-between mb-2">
    <h6 class="mb-0">
      Routes for: <span class="text-primary">{{ selectedRole()?.role }}</span>
    </h6>
    <!-- <small class="text-muted" *ngIf="permLoading()">Loading permissionsâ€¦</small> -->
    <small class="text-danger" *ngIf="permError()">{{ permError() }}</small>
  </div>

  <ag-grid-angular
    class="ag-theme-quartz dw-grid-theme routes-grid"
    style="width: 100%; height: 440px"
    [rowData]="rolesroutes()"
    [rowHeight]="38"
    rowSelection="single"
    [columnDefs]="permColumnDefs"
    [defaultColDef]="defaultColDef"
    [suppressRowClickSelection]="false"
    [enableCellTextSelection]="true"
    [pagination]="true"
    [paginationPageSize]="pageSize"
    [paginationPageSizeSelector]="pageSizeOptions"
    [pagination]="true"
    (gridReady)="onGridReady($event)"
    (cellKeyDown)="onGridCellKeyDown($event)"
  >
  </ag-grid-angular>
</div>
<!-- 
    (gridReady)="onPermGridReady($event)"
    (cellValueChanged)="onPermissionChanged($event)" -->