.workflow-editor { min-height: 100%; display:flex; flex-direction: column; }
.editor-header { position: sticky; top: 0; z-index: 10; }
.editor-body { min-height: calc(100vh - 64px); }
.editor-body { overflow-x: hidden; }

.stages-panel { 
	/* Use percentage layout for wide screens */
	flex: 0 0 25%;
	max-width: 25%;
	background: var(--bs-body-bg); 
	display:flex; 
	flex-direction: column; 
	/* fallback min width to avoid collapse */
	min-width: 240px; 
	overflow: hidden; /* clip drag ring / preview expansion to avoid page scrollbars */
}
.editor-main {
	flex: 0 0 75%;
	max-width: 75%;
	min-width: 0; /* allow content to shrink properly */
	display:flex;
	flex-direction: column;
}
@media (max-width: 992px) { 
	.stages-panel { 
		flex: 0 0 100%;
		max-width: 100%;
		width: 100%;
		min-width: 0;
		border-right: none; 
		border-bottom:1px solid var(--bs-border-color,rgba(0,0,0,.15)); 
	}
	.editor-main { 
		flex: 0 0 100%;
		max-width: 100%;
	}
	.editor-body { flex-direction: column; }
}

.stages-scroll { 
	overflow-y: auto; 
	overflow-x: hidden; 
	padding: .5rem .6rem; 
	display:flex; 
	flex-direction: column; 
	gap: .55rem; 
	/* Hide scrollbars always (still scrollable) */
	scrollbar-width: none; /* Firefox */
	-ms-overflow-style: none; /* IE/Edge */
	/* Prevent layout shift / accidental horizontal scroll after drag */
	contain: layout paint; /* isolate drag transforms */
	overscroll-behavior: contain; /* prevent parent scrolling flicker */
}
.stages-scroll::-webkit-scrollbar { width:0; height:0; display:none; }

/* Sticky bar when order changed */
.order-dirty-bar {
	position: sticky;
	bottom: 0;
	left:0;
	width:100%;
	background: var(--bs-body-bg);
	border-top:1px solid var(--bs-border-color,rgba(0,0,0,.12));
	display:flex;
	align-items:center;
	gap:.5rem;
	padding:.4rem .55rem;
	box-shadow:0 -2px 6px -3px rgba(0,0,0,.12);
	z-index:5;
}
body.dark .order-dirty-bar { background:#252b32; border-color: rgba(255,255,255,.15); box-shadow:0 -2px 6px -3px rgba(0,0,0,.65); }

/* Extra small button size for inline bar */
.btn.btn-xxs { --bs-btn-padding-y: .15rem; --bs-btn-padding-x: .4rem; font-size:.6rem; line-height:1; }

/* Vertical variant of status-card (mirrors locations but stacked) */
.status-card.vertical {
	background: var(--bs-body-bg);
	border:1px solid transparent;
	border-radius:.75rem;
	padding:.65rem .65rem .65rem;
	box-shadow: 0 0 0 1px var(--bs-border-color, rgba(0,0,0,.12)), 0 1px 2px rgba(0,0,0,.05);
	position: relative;
	display:flex;
	flex-direction:column;
	justify-content:flex-start;
	transition: box-shadow .3s ease, background .3s ease;
	cursor:grab;
}
.status-card.vertical:active { cursor:grabbing; }
.status-card.vertical:hover {
	box-shadow: 0 0 0 1px rgba(var(--bs-primary-rgb,13,110,253), .35), 0 4px 16px -6px rgba(0,0,0,.18);
}
.status-card.vertical.active {
	/* Clean active state: stronger border + subtle glow inside bounds (no pseudo elements) */
	box-shadow: 0 0 0 2px var(--bs-primary,#0d6efd), 0 4px 14px -4px rgba(0,0,0,.28);
	background: linear-gradient(135deg, rgba(var(--bs-primary-rgb,13,110,253),.10) 0%, rgba(var(--bs-primary-rgb,13,110,253),.03) 100%);
	position: relative;
	z-index: 2;
}
/* Remove old halo animations to avoid flicker / overflow */
.status-card.vertical.active::before,
.status-card.vertical.active::after { display:none !important; }
.status-card.vertical .icon-box {
	width:30px; height:30px; border-radius:.65rem;
	background: linear-gradient(135deg, rgba(var(--bs-primary-rgb,13,110,253),.12) 0%, rgba(var(--bs-primary-rgb,13,110,253),.04) 100%);
	display:flex; align-items:center; justify-content:center;
	color: var(--bs-primary,#0d6efd); font-size:15px;
}
.status-card.vertical .move-icon { width:26px; height:30px; display:flex; align-items:center; justify-content:center; color: var(--bs-secondary-color,rgba(0,0,0,.55)); font-size:15px; }
.status-card.vertical.cdk-drag-preview { box-shadow:0 0 0 1px var(--bs-primary,#0d6efd), 0 6px 24px -4px rgba(0,0,0,.35); border-radius:.75rem; }
.status-card.vertical.cdk-drag-placeholder { opacity:0; }
.cdk-drop-list-dragging .status-card.vertical:not(.cdk-drag-placeholder) { transition: transform .18s cubic-bezier(.2,.65,.35,1); }
.status-card.vertical .order-badge { min-width:24px; height:24px; font-size:.65rem; line-height:1; display:flex; align-items:center; justify-content:center; background: var(--bs-secondary-bg,rgba(0,0,0,.06)); color: var(--bs-secondary-color,rgba(0,0,0,.6)); border-radius: 1rem; padding:0 .35rem; font-weight:600; }
body.dark .status-card.vertical .order-badge { background:#39424b; color:rgba(255,255,255,.65); }
body.dark .status-card.vertical .move-icon { color:rgba(255,255,255,.55); }

/* Toolbar */
.stages-toolbar { border-bottom:1px solid var(--bs-border-color,rgba(0,0,0,.12)); }
.stages-toolbar .form-control { font-size:.7rem; }
.stages-toolbar .btn.btn-xs { --bs-btn-padding-y: .25rem; --bs-btn-padding-x: .45rem; font-size:.65rem; line-height:1; }

/* Reorder disabled state (visual hint) */

/* Hint text subtle */
.stages-toolbar .hint { font-size:.6rem; letter-spacing:.25px; }

/* Focus ring for keyboard navigation */
.status-card.vertical:focus { outline:2px solid var(--bs-primary,#0d6efd); outline-offset:2px; }

/* Data Collection card tweaks */
.data-collection-card { border-radius:.85rem; }
.data-collection-card .card-header { border-bottom:1px solid var(--bs-border-color,rgba(0,0,0,.08)); background:transparent; }
.data-collection-card .form-check-input { cursor:pointer; }
.data-collection-card .form-switch-grid .form-check-label { line-height:1.25; }
.data-collection-card .form-switch-grid .form-check:not(:last-child) { padding-bottom:.25rem; }
.data-collection-card .form-switch-grid .form-check:last-child { padding-bottom:0; }
body.dark .data-collection-card .card-header { border-color: rgba(255,255,255,.12); }
body.dark .data-collection-card .form-switch-grid .form-check:not(:last-child) { border-color: rgba(255,255,255,.12); }
.rules-card { border-radius:.85rem; }
.rules-card .card-header { border-bottom:1px solid var(--bs-border-color,rgba(0,0,0,.08)); background:transparent; }
.rules-card .rules-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(200px,1fr)); gap:1rem 1.25rem; }
.rules-card .form-label { font-size:.6rem; letter-spacing:.25px; text-transform:uppercase; }
body.dark .rules-card .card-header { border-color: rgba(255,255,255,.12); }
.rules-card select.form-select, .rules-card input.form-control { font-size:.7rem; }
.rules-card h6 { font-size:.8rem; }
.rules-card .rule-condition-block { position:relative; }
.rules-card .rule-condition-block hr { border-color: var(--bs-border-color,rgba(0,0,0,.08)); }
body.dark .rules-card .rule-condition-block hr { border-color: rgba(255,255,255,.12); }
.status-card.vertical .status-text { font-size:.85rem; }
.status-card.vertical .sub-status { font-size:.70rem; margin-top:.1rem; letter-spacing:.3px; font-weight:500; color: var(--bs-secondary-color, rgba(0,0,0,.55)); }
.status-card.vertical .meta { opacity:.85; }

body.dark .status-card.vertical { background:#252b32; box-shadow:0 0 0 1px rgba(255,255,255,.12), 0 1px 2px rgba(0,0,0,.6); }
body.dark .status-card.vertical:hover { background:#2f3740; }
body.dark .status-card.vertical.active { background:#2f3740; }
body.dark .status-card.vertical .sub-status { color: rgba(255,255,255,.55); }

/* Empty state (Apple-inspired minimal aesthetic) */
.empty-state { position:relative; }
.empty-icon-wrapper { width:86px; height:86px; border-radius:24px; position:relative; }
.empty-icon-wrapper .gradient-ring { position:absolute; inset:0; border-radius:24px; background:linear-gradient(135deg, rgba(var(--bs-primary-rgb,13,110,253),.18), rgba(var(--bs-primary-rgb,13,110,253),.05)); display:flex; align-items:center; justify-content:center; box-shadow:0 2px 6px -2px rgba(0,0,0,.15), 0 4px 18px -6px rgba(0,0,0,.25); backdrop-filter: blur(2px); }
.empty-main-icon { font-size:34px; color: var(--bs-primary,#0d6efd); opacity:.85; }
.empty-stage-svg { display:block; width:54px; height:54px; filter: drop-shadow(0 2px 4px rgba(0,0,0,.18)); }
@media (prefers-reduced-motion: no-preference) {
	.empty-stage-svg circle:nth-of-type(2) { animation: pulseStage 3.2s ease-in-out infinite; transform-origin: 27px 27px; }
}
@keyframes pulseStage { 0%,100% { transform: scale(1); } 50% { transform: scale(1.075); } }
.empty-title { font-weight:600; letter-spacing:.25px; font-size:1.05rem; }
.empty-subtitle { max-width:520px; margin-left:auto; margin-right:auto; font-size:.8rem; color: var(--bs-secondary-color,rgba(0,0,0,.58)); letter-spacing:.25px; }
.empty-hint { font-size:.65rem; letter-spacing:.3px; }
body.dark .empty-subtitle { color: rgba(255,255,255,.58); }
body.dark .empty-icon-wrapper .gradient-ring { background:linear-gradient(135deg, rgba(var(--bs-primary-rgb,13,110,253),.25), rgba(var(--bs-primary-rgb,13,110,253),.07)); box-shadow:0 4px 14px -4px rgba(0,0,0,.75); }


/* Consistent dialog style (reuse pattern from workflows-dialog) */
.dw-acc-stage-dialog, .dw-acc-rule-dialog, .dw-acc-clone-dialog { position:fixed; inset:0; z-index:1060; }
.dw-acc-dialog-backdrop { position:absolute; inset:0; background:rgba(0,0,0,.35); backdrop-filter:blur(2px); }
.dw-acc-dialog { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:460px; max-width:95%; }
.dw-acc-dialog .card-header { background:transparent; border-bottom:1px solid var(--bs-border-color,rgba(0,0,0,.08)); }
body.dark .dw-acc-dialog .card-header { border-color: rgba(255,255,255,.12); }
.dw-acc-dialog h6 { font-size:.85rem; letter-spacing:.3px; }
.dw-acc-dialog .form-label { font-size:.6rem; letter-spacing:.25px; text-transform:uppercase; }
.dw-acc-dialog select.form-select, .dw-acc-dialog input.form-control { font-size:.7rem; }

@keyframes pulseHalo {
	0% { opacity:0; transform: scale(.6); }
	20% { opacity:.55; }
	60% { opacity:.35; }
	100% { opacity:0; transform: scale(1.15); }
}

@keyframes ringFade {
	0% { opacity:0; transform: scale(.96); }
	15% { opacity:1; }
	100% { opacity:1; transform: scale(1); }
}

@media (prefers-reduced-motion: reduce) {
	.status-card.vertical.active::before,
	.status-card.vertical.active::after { animation:none; }
}

/* Header actions dropdown: place near the right edge and keep the default bootstrap placement (below) */
.editor-header .editor-actions { right: .25rem; }
.editor-header .editor-actions .dropdown-menu { box-shadow: 0 6px 24px -6px rgba(0,0,0,.2); padding:.25rem 0; }
.editor-header .editor-actions .dropdown-item { font-size:.85rem; }

.dropdown-menu{
	position: relative!important;
}